<div class="dynamic-form">
  <form [formGroup]="form" (ngSubmit)="handleSubmit()">
    <div class="form-fields">
      <div class="form-group" *ngFor="let field of config.fields">
        <!-- Text, Email, Password, Number, Date, Tel, URL inputs -->
        <ng-container *ngIf="['text', 'email', 'number', 'date', 'tel', 'url'].includes(field.type)">
          <label [for]="field.name" class="form-label">
            {{ field.label }}
            <span class="required" *ngIf="field.required">*</span>
          </label>
          <input
            [id]="field.name"
            [formControlName]="field.name"
            [type]="getFieldType(field.type)"
            [class.form-input]="true"
            [class.is-invalid]="
              form.get(field.name)?.invalid && (form.get(field.name)?.dirty || submitted)
            "
            [placeholder]="field.placeholder || ''"
            [readonly]="field.readonly || false"
          />
          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>

        <!-- Password with toggle -->
        <ng-container *ngIf="field.type === 'password'">
          <label [for]="field.name" class="form-label">
            {{ field.label }}
            <span class="required" *ngIf="field.required">*</span>
            
            <div class="tooltip-container">
              <ng-icon name="heroInformationCircle" size="1rem" class="info-icon"></ng-icon>
              <div class="tooltip-content">
                <ul>
                  <li *ngFor="let req of getPasswordRequirements(form.get(field.name)?.value)" [class.met]="req.met">
                    <span class="icon">{{ req.met ? '✓' : '○' }}</span> {{ req.label }}
                  </li>
                </ul>
              </div>
            </div>
          </label>
          <div class="password-wrapper">
            <input
              [id]="field.name"
              [formControlName]="field.name"
              [type]="isPasswordVisible(field.name) ? 'text' : 'password'"
              [class.form-input]="true"
              [class.is-invalid]="form.get(field.name)?.invalid && (form.get(field.name)?.dirty || submitted)"
              [placeholder]="field.placeholder || ''"
              [readonly]="field.readonly || false"
            />
            <button type="button" class="password-toggle" (click)="togglePasswordVisibility(field.name)">
              <ng-icon [name]="isPasswordVisible(field.name) ? 'heroEyeSlash' : 'heroEye'" size="1.2rem"></ng-icon>
            </button>
          </div>

          <div class="password-strength" *ngIf="form.get(field.name)?.value">
            <div class="strength-bar">
              <div class="strength-fill"
                   [style.width.%]="getPasswordStrength(form.get(field.name)?.value).width"
                   [style.background-color]="getPasswordStrength(form.get(field.name)?.value).color">
              </div>
            </div>
            <span class="strength-label" [style.color]="getPasswordStrength(form.get(field.name)?.value).color">
              {{ getPasswordStrength(form.get(field.name)?.value).label }}
            </span>
          </div>

          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>

        <!-- Textarea -->
        <ng-container *ngIf="field.type === 'textarea'">
          <label [for]="field.name" class="form-label">
            {{ field.label }}
            <span class="required" *ngIf="field.required">*</span>
          </label>
          <textarea
            [id]="field.name"
            [formControlName]="field.name"
            [class.form-input]="true"
            [class.is-invalid]="
              form.get(field.name)?.invalid && (form.get(field.name)?.dirty || submitted)
            "
            [placeholder]="field.placeholder || ''"
            [rows]="field.rows || 4"
            [cols]="field.cols || 50"
            [readonly]="field.readonly || false"
          ></textarea>
          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>

        <!-- Select -->
<ng-container *ngIf="field.type === 'select'">
  <label [for]="field.name" class="form-label">
    {{ field.label }}
    <span class="required" *ngIf="field.required">*</span>
  </label>
          <app-select-search
            [formControlName]="field.name"
            [options]="field.options || []"
            [placeholder]="field.placeholder || 'Seleccione'"
          ></app-select-search>

  <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
    {{ field.helpText }}
  </small>
  <small class="error-text" *ngIf="getFieldError(field.name)">
    {{ getFieldError(field.name) }}
  </small>
</ng-container>



        <!-- Checkbox -->
        <ng-container *ngIf="field.type === 'checkbox'">
          <div class="checkbox-group">
            <input
              [id]="field.name"
              type="checkbox"
              [formControlName]="field.name"
              class="checkbox-input"
            />
            <label [for]="field.name" class="checkbox-label">
              {{ field.label }}
              <span class="required" *ngIf="field.required">*</span>
            </label>
          </div>
          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>

        <!-- Switch -->
        <ng-container *ngIf="field.type === 'switch'">
          <div class="switch-group">
            <label [for]="field.name" class="switch-container">
              <input
                [id]="field.name"
                type="checkbox"
                [formControlName]="field.name"
                class="switch-input"
              />
              <span class="switch-slider"></span>
            </label>
            <span class="switch-label">
              {{ field.label }}
              <span class="required" *ngIf="field.required">*</span>
            </span>
          </div>
          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-cancel" (click)="handleCancel()">
        {{ config.cancelButtonLabel || 'Cancelar' }}
      </button>
      <button
        type="submit"
        class="btn btn-submit"
        [disabled]="config.submitButtonDisabled || false"
      >
        {{ config.submitButtonLabel || 'Enviar' }}
      </button>
    </div>
  </form>
</div>

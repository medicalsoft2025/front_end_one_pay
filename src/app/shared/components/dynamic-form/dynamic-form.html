<div class="dynamic-form">
  <form [formGroup]="form" (ngSubmit)="handleSubmit()">
    <div class="form-fields">
      <div class="form-group" *ngFor="let field of config.fields">
        <!-- Text, Email, Password, Number, Date, Tel, URL inputs -->
        <ng-container *ngIf="['text', 'email', 'password', 'number', 'date', 'tel', 'url'].includes(field.type)">
          <label [for]="field.name" class="form-label">
            {{ field.label }}
            <span class="required" *ngIf="field.required">*</span>
          </label>
          <input
            [id]="field.name"
            [formControlName]="field.name"
            [type]="getFieldType(field.type)"
            [class.form-input]="true"
            [class.is-invalid]="
              form.get(field.name)?.invalid && (form.get(field.name)?.dirty || submitted)
            "
            [placeholder]="field.placeholder || ''"
            [readonly]="field.readonly || false"
            [disabled]="field.disabled || false"
          />
          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>

        <!-- Textarea -->
        <ng-container *ngIf="field.type === 'textarea'">
          <label [for]="field.name" class="form-label">
            {{ field.label }}
            <span class="required" *ngIf="field.required">*</span>
          </label>
          <textarea
            [id]="field.name"
            [formControlName]="field.name"
            [class.form-input]="true"
            [class.is-invalid]="
              form.get(field.name)?.invalid && (form.get(field.name)?.dirty || submitted)
            "
            [placeholder]="field.placeholder || ''"
            [rows]="field.rows || 4"
            [cols]="field.cols || 50"
            [readonly]="field.readonly || false"
            [disabled]="field.disabled || false"
          ></textarea>
          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>

        <!-- Select -->
<ng-container *ngIf="field.type === 'select'">
  <label [for]="field.name" class="form-label">
    {{ field.label }}
    <span class="required" *ngIf="field.required">*</span>
  </label>

  <div
    class="custom-select-container"
    [class.disabled]="field.disabled"
    (click)="toggleDropdown(field.name)"
  >
    <!-- OpciÃ³n seleccionada -->
    <div class="selected-option">
      <img
        *ngIf="getSelectedOption(field.name, field.options ?? [])?.logo"
        [src]="getSelectedOption(field.name, field.options ?? [])?.logo"
        width="20"
        height="20"
        style="margin-right: 5px; vertical-align: middle;"
        alt="{{ getSelectedOption(field.name, field.options ?? [])?.label }}"
      />
      <span>
        {{ getSelectedOption(field.name, field.options ?? [])?.label || field.placeholder || 'Selecciona' }}
      </span>
    </div>

    <!-- Dropdown de opciones -->
    <div class="options-dropdown" *ngIf="isDropdownOpen(field.name)">
      <div
        class="option-item"
        *ngFor="let option of field.options"
        (click)="selectOption(field.name, option, $event)"
      >
        <img
          *ngIf="option.logo"
          [src]="option.logo"
          width="20"
          height="20"
          style="margin-right: 5px; vertical-align: middle;"
          alt="{{ option.label }}"
        />
        {{ option.label }}
      </div>
    </div>
  </div>

  <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
    {{ field.helpText }}
  </small>
  <small class="error-text" *ngIf="getFieldError(field.name)">
    {{ getFieldError(field.name) }}
  </small>
</ng-container>



        <!-- Checkbox -->
        <ng-container *ngIf="field.type === 'checkbox'">
          <div class="checkbox-group">
            <input
              [id]="field.name"
              type="checkbox"
              [formControlName]="field.name"
              [disabled]="field.disabled || false"
              class="checkbox-input"
            />
            <label [for]="field.name" class="checkbox-label">
              {{ field.label }}
              <span class="required" *ngIf="field.required">*</span>
            </label>
          </div>
          <small class="help-text" *ngIf="field.helpText && !getFieldError(field.name)">
            {{ field.helpText }}
          </small>
          <small class="error-text" *ngIf="getFieldError(field.name)">
            {{ getFieldError(field.name) }}
          </small>
        </ng-container>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-submit"
        [disabled]="config.submitButtonDisabled || false"
      >
        {{ config.submitButtonLabel || 'Enviar' }}
      </button>
      <button type="button" class="btn btn-cancel" (click)="handleCancel()">
        {{ config.cancelButtonLabel || 'Cancelar' }}
      </button>
    </div>
  </form>
</div>
